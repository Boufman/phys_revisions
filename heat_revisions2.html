<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Medical AR Heat Trainer</title>
  <!-- Load model-viewer for iOS AR -->
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <style>
    body { margin: 0; font-family: -apple-system, sans-serif; }
    #ar-view { width: 100vw; height: 100vh; }
    #fallback-ui { display: none; }
    .button { 
      padding: 12px; margin: 5px; 
      background: #007AFF; color: white; 
      border: none; border-radius: 20px; 
    }
    #controls {
      position: fixed;
      bottom: 20px;
      left: 0;
      right: 0;
      text-align: center;
      z-index: 100;
    }
  </style>
</head>
<body>

<!-- AR View (iOS/ARKit) -->
<model-viewer 
  id="ar-view"
  ar
  ar-modes="scene-viewer webxr quick-look"
  src="https://modelviewer.dev/shared-assets/models/globe/globe.glb"
  camera-controls
  environment-image="neutral"
  shadow-intensity="1"
  auto-rotate
  ar-scale="fixed"
>
  <!-- Fallback UI if AR not supported -->
  <div id="fallback-ui" slot="ar-prompt">
    <h2>AR not supported</h2>
    <p>Switch to camera overlay mode:</p>
    <button class="button" onclick="activateCameraOverlay()">Use 2D Mode</button>
  </div>
</model-viewer>

<!-- Controls -->
<div id="controls">
  <button class="button" onclick="placeObject('ice')">‚ùÑÔ∏è Ice Pack</button>
  <button class="button" onclick="placeObject('fan')">üåÄ Fan</button>
</div>

<script>
  // Check if AR is supported
  const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
  const arViewer = document.getElementById('ar-view');

  if (!isIOS) {
    // Android/WebXR: Use full WebXR AR
    arViewer.setAttribute('ar-modes', 'webxr');
  }

  // Place AR objects
  function placeObject(type) {
    if ('xr' in navigator) {
      // WebXR AR (Android)
      startWebXR(type);
    } else if (isIOS) {
      // iOS AR Quick Look
      showQuickLook(type);
    } else {
      // Fallback to 2D camera
      activateCameraOverlay();
    }
  }

  // iOS AR Quick Look (works in Safari)
  function showQuickLook(type) {
    const modelUrl = type === 'ice' 
      ? 'https://example.com/ice-pack.usdz' 
      : 'https://example.com/fan.usdz';
    
    arViewer.setAttribute('src', modelUrl);
    arViewer.activateAR();
  }

  // Android/WebXR AR
  async function startWebXR(type) {
    try {
      const session = await navigator.xr.requestSession('immersive-ar');
      console.log('WebXR AR started');
      // Add 3D object logic here
    } catch (e) {
      console.error('AR failed:', e);
      activateCameraOverlay();
    }
  }

  // Fallback: 2D Camera Overlay (works everywhere)
  function activateCameraOverlay() {
    document.body.innerHTML = `
      <video id="camera" autoplay playsinline></video>
      <canvas id="overlay"></canvas>
      <div id="controls">
        <button class="button" onclick="simulateEffect('ice')">‚ùÑÔ∏è Ice Pack</button>
        <button class="button" onclick="simulateEffect('fan')">üåÄ Fan</button>
      </div>
    `;
    
    // Start camera
    navigator.mediaDevices.getUserMedia({ video: true })
      .then(stream => {
        document.getElementById('camera').srcObject = stream;
      });
  }

  // Simulate heat effects (2D overlay)
  function simulateEffect(type) {
    const canvas = document.getElementById('overlay');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    
    if (type === 'ice') {
      // Blue conduction effect
      ctx.fillStyle = 'rgba(0, 100, 255, 0.3)';
      ctx.beginPath();
      ctx.arc(canvas.width/2, canvas.height/2, 50, 0, Math.PI*2);
      ctx.fill();
    } else {
      // Red convection effect
      ctx.fillStyle = 'rgba(255, 50, 0, 0.3)';
      for (let i = 0; i < 5; i++) {
        ctx.beginPath();
        ctx.arc(canvas.width/2, canvas.height/2 - i*30, 40, 0, Math.PI*2);
        ctx.fill();
      }
    }
    
    // Show quiz
    setTimeout(() => askQuestion(type), 2000);
  }

  function askQuestion(type) {
    const question = type === 'ice' 
      ? "The blue area shows heat transfer via:" 
      : "The rising red waves demonstrate:";
    alert(question + "\n\nA) Conduction\nB) Convection\nC) Radiation");
  }
</script>
</body>
</html>
