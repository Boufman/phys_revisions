<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>AR Heat Transfer Trainer</title>
  <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  <style>
    body { margin: 0; overflow: hidden; }
    #info {
      position: absolute;
      bottom: 20px;
      left: 10px;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 10px;
      border-radius: 5px;
      z-index: 100;
    }
  </style>
</head>
<body>
  <!-- AR Scene -->
  <a-scene embedded arjs="trackingMethod: best;">
    <!-- Heat Visualization (Appears when markers are detected) -->
    <a-entity id="heat-overlay" material="color: red; opacity: 0.5" 
              geometry="primitive: plane; width: 0.3; height: 0.3" 
              position="0 0 -0.5" visible="false">
    </a-entity>
    
    <!-- UI for AR interactions -->
    <a-entity id="ar-ui">
      <a-text value="Tap to place thermal object" 
              position="0 -0.3 -0.5" 
              align="center" color="white" visible="false"></a-text>
    </a-entity>
  </a-scene>

  <!-- Instructions -->
  <div id="info">
    <strong>Clinical AR Trainer</strong><br>
    Point your camera at a flat surface. Tap to simulate:
    <button onclick="placeObject('ice')">Ice Pack</button>
    <button onclick="placeObject('fan')">Fan</button>
  </div>

  <script>
    const scene = document.querySelector('a-scene');
    const heatOverlay = document.querySelector('#heat-overlay');
    const arUI = document.querySelector('#ar-ui');

    // AR Object Placement
    function placeObject(type) {
      // Show AR prompt
      arUI.setAttribute('visible', 'true');
      
      // Handle screen tap
      scene.addEventListener('click', (e) => {
        const position = e.detail.intersection.point;
        
        // Create object
        const obj = document.createElement('a-entity');
        obj.setAttribute('position', position);
        
        switch(type) {
          case 'ice':
            obj.setAttribute('geometry', 'primitive: box; width: 0.1; height: 0.1; depth: 0.1');
            obj.setAttribute('material', 'color: blue; opacity: 0.7');
            obj.setAttribute('class', 'conduction');
            break;
          case 'fan':
            obj.setAttribute('geometry', 'primitive: circle; radius: 0.15');
            obj.setAttribute('material', 'color: gray; opacity: 0.5');
            obj.setAttribute('class', 'convection');
            break;
        }
        
        scene.appendChild(obj);
        simulateHeatTransfer(type, position);
      }, { once: true });
    }

    // Dynamic Heat Simulation
    function simulateHeatTransfer(type, position) {
      heatOverlay.setAttribute('visible', 'true');
      heatOverlay.setAttribute('position', position);
      
      if (type === 'ice') {
        // Conduction effect (blue cooling spread)
        heatOverlay.setAttribute('animation', {
          property: 'scale',
          to: '2 2 1',
          dur: 3000,
          easing: 'linear'
        });
        heatOverlay.setAttribute('material', 'color: blue; opacity: 0.4');
      } else if (type === 'fan') {
        // Convection effect (rising heat waves)
        heatOverlay.setAttribute('animation', {
          property: 'position',
          to: `${position.x} ${position.y + 0.5} ${position.z}`,
          dur: 2000,
          easing: 'easeOutQuad'
        });
        heatOverlay.setAttribute('material', 'color: red; opacity: 0.3');
      }
      
      // Show quiz after 3 seconds
      setTimeout(() => askQuestion(type), 3000);
    }

    // Quiz Logic (same as before)
    function askQuestion(type) {
      const questions = {
        ice: "The blue spread shows heat transfer via:",
        fan: "The rising red waves demonstrate:"
      };
      alert(questions[type] + "\n\nA) Conduction\nB) Convection\nC) Radiation");
    }
  </script>
</body>
</html>
